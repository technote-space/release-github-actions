import path from 'path';
import { Context } from '@actions/github/lib/context';
import { components } from '@octokit/openapi-types';
import { Logger } from '@technote-space/github-action-log-helper';
import { Octokit } from './types';
declare type GitCreateTreeResponseData = components['schemas']['git-tree'];
declare type GitCreateCommitResponseData = components['schemas']['git-commit'];
declare type PullsListResponseData = components['schemas']['pull-request-simple'];
declare type PullsCreateResponseData = components['schemas']['pull-request'];
declare type PullsUpdateResponseData = components['schemas']['pull-request'];
declare type PullsUpdateParams = {
    body?: string;
    draft?: boolean;
    state?: 'open' | 'closed' | undefined;
    title?: string;
    base?: string;
};
declare type PullsCreateParams = PullsUpdateParams & {
    title: string;
};
declare type PullsInfo = {
    'html_url': string;
    'commits_url': string;
    'comments_url': string;
    id: number;
    number: number;
    isPrCreated: boolean;
};
declare type PullsListParams = {
    base?: string;
    direction?: 'asc' | 'desc';
    head?: string;
    sort?: 'created' | 'updated' | 'popularity' | 'long-running';
    state?: 'open' | 'closed' | 'all';
};
/**
 * API Helper
 */
export default class ApiHelper {
    private readonly octokit;
    private readonly context;
    private readonly logger?;
    private readonly branch?;
    private readonly sender?;
    private readonly suppressBPError?;
    private readonly refForUpdate?;
    private prCache;
    /**
     * @param {RestEndpointMethods} octokit octokit
     * @param {Context} context context
     * @param {Logger} logger logger
     * @param {object} options options
     * @param {string|undefined} options.branch branch
     * @param {string|undefined} options.sender sender
     * @param {string|undefined} options.refForUpdate ref for update
     * @param {boolean|undefined} options.suppressBPError suppress branch protection error?
     */
    constructor(octokit: Octokit, context: Context, logger?: Logger | undefined, options?: {
        branch?: string;
        sender?: string;
        refForUpdate?: string;
        suppressBPError?: boolean;
    });
    /**
     * @param {OctokitResponse} response response
     * @return {any} data
     */
    private getResponseData;
    /**
     * @param {function} caller caller
     */
    private callLogger;
    /**
     * @return {string|boolean} sender
     */
    private getSender;
    /**
     * @param {boolean} encode encode?
     * @return {string} ref for update
     */
    getRefForUpdate: (encode: boolean) => Promise<string>;
    /**
     * @param {string} rootDir root dir
     * @param {string} filepath filepath
     * @return {Promise<{ path: string, sha: string }>} blob
     */
    private createBlob;
    /**
     * @return {string} commit sha
     */
    private getCommitSha;
    /**
     * @return {Promise<GitGetCommitResponseData>} commit
     */
    private getCommit;
    /**
     * @return {Promise<PullsGetResponseData>} commit
     */
    private getPR;
    /**
     * @param {string} rootDir root dir
     * @param {object} files files
     * @return {Promise<Array<{ path: string, sha: string }>>} blobs
     */
    filesToBlobs: (rootDir: string, files: Array<string>) => Promise<Array<{
        path: string;
        sha: string;
    }>>;
    /**
     * @param {Array<{ path: string, sha: string }>} blobs blobs
     * @return {Promise<GitCreateTreeResponseData>} tree
     */
    createTree: (blobs: Array<{
        path: string;
        sha: string;
    }>) => Promise<GitCreateTreeResponseData>;
    /**
     * @param {string} commitMessage commit message
     * @param {GitCreateTreeResponseData} tree tree
     * @return {Promise<GitCreateCommitResponseData>} commit
     */
    createCommit: (commitMessage: string, tree: GitCreateTreeResponseData) => Promise<GitCreateCommitResponseData>;
    /**
     * @param {string} refName refName
     * @return {Promise<GitGetRefResponseData|null>} refName
     */
    private getRef;
    /**
     * @param {GitCreateCommitResponseData} commit commit
     * @param {string} refName refName
     * @param {boolean} force force
     * @return {Promise<boolean>} updated?
     */
    updateRef: (commit: GitCreateCommitResponseData, refName: string, force: boolean) => Promise<boolean>;
    /**
     * @param {GitCreateCommitResponseData} commit commit
     * @param {string} refName refName
     * @return {Promise<void>} void
     */
    createRef: (commit: GitCreateCommitResponseData, refName: string) => Promise<void>;
    /**
     * @param {string} refName refName
     * @return {Promise<void>} void
     */
    deleteRef: (refName: string) => Promise<void>;
    /**
     * @param {string} branchName branch name
     * @return {Promise<PullsListResponseData | null>} pull request
     */
    findPullRequest: (branchName: string) => Promise<PullsListResponseData | null>;
    /**
     * @param {PullsListParams} params params
     * @return {AsyncIterable<Array<PullsListResponseData>>} pull request list
     */
    pullsList: (params: PullsListParams) => Promise<Array<PullsListResponseData>>;
    /**
     * @param {string} branchName branch name
     * @param {PullsCreateParams} detail detail
     * @return {Promise<PullsCreateResponseData>} pull
     */
    pullsCreate: (branchName: string, detail: PullsCreateParams) => Promise<PullsCreateResponseData>;
    /**
     * @param {number} number pull number
     * @param {PullsUpdateParams} detail detail
     * @return {Promise<PullsUpdateResponseData>} pull
     */
    pullsUpdate: (number: number, detail: PullsUpdateParams) => Promise<PullsUpdateResponseData>;
    /**
     * @param {string} branch branch
     * @return {object} branch info
     */
    getBranchInfo: (branch: string) => {
        branchName: string;
        headName: string;
        refName: string;
    };
    /**
     * @param {string} createBranchName branch name
     * @param {PullsCreateParams} detail detail
     * @return {Promise<PullsInfo>} info
     */
    private createPulls;
    /**
     * @param {string} createBranchName branch name
     * @param {PullsCreateParams} detail detail
     * @return {Promise<PullsInfo>} info
     */
    pullsCreateOrUpdate: (createBranchName: string, detail: PullsCreateParams) => Promise<PullsInfo>;
    /**
     * @param {string} createBranchName branch name
     * @param {PullsCreateParams} detail detail
     * @return {Promise<PullsInfo>} info
     */
    pullsCreateOrComment: (createBranchName: string, detail: PullsCreateParams) => Promise<PullsInfo>;
    /**
     * @param {string} branch branch
     * @param {string} body body
     * @return {Promise<boolean>} result
     */
    createCommentToPr: (branch: string, body: string | undefined) => Promise<boolean>;
    /**
     * @param {Error} error error
     * @return {boolean} result
     */
    private isProtectedBranchError;
    /**
     * @param {Array<string>} files files
     * @return {boolean} diff?
     */
    private checkDiff;
    /**
     * @param {string} rootDir root dir
     * @param {string} commitMessage commit message
     * @param {Array<string>} files files
     * @return {Promise<GitCreateCommitResponseData>} commit
     */
    private prepareCommit;
    /**
     * @param {string} rootDir root dir
     * @param {string} commitMessage commit message
     * @param {Array<string>} files files
     * @return {Promise<boolean>} result
     */
    commit: (rootDir: string, commitMessage: string, files: Array<string>) => Promise<boolean>;
    /**
     * @param {string} rootDir root dir
     * @param {string} commitMessage commit message
     * @param {Array<string>} files files
     * @param {string} createBranchName branch name
     * @param {PullsCreateParams} detail detail
     * @return {Promise<boolean|PullsInfo>} result
     */
    createPR: (rootDir: string, commitMessage: string, files: Array<string>, createBranchName: string, detail: PullsCreateParams) => Promise<boolean | PullsInfo>;
    /**
     * @param {string} createBranchName branch name
     * @param {string} message message
     */
    closePR: (createBranchName: string, message?: string | undefined) => Promise<void>;
    /**
     * @return {Promise<{ login: string, email: string, name: string, id: number }>} user
     */
    getUser: () => Promise<{
        login: string;
        email: string;
        name: string;
        id: number;
    }>;
    /**
     * @return {Promise<string>} default branch
     */
    getDefaultBranch: () => Promise<string>;
    /**
     * @return {Promise<Array<string>>} tags
     */
    getTags: () => Promise<Array<string>>;
    /**
     * @return {Promise<string>} tag
     */
    getLastTag: () => Promise<string>;
    /**
     * @return {Promise<string>} tag
     */
    getNewPatchVersion: () => Promise<string>;
    /**
     * @return {Promise<string>} tag
     */
    getNewMinorVersion: () => Promise<string>;
    /**
     * @return {Promise<string>} tag
     */
    getNewMajorVersion: () => Promise<string>;
}
export {};
